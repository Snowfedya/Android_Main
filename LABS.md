# LABS.md - Детальное техническое задание для лабораторных работ

## О проекте WillPower Tracker

**Название:** WillPower Tracker (Психология + тайм-менеджмент)

**Суть:** Трекер привычек/челленджей против прокрастинации + "AI-ментор" (генерирует мотивационные цитаты/советы и краткий анализ прогресса).

**Идея онбординга:** Методика "Сила воли" (Kelly McGonigal) - мини-пояснение и визуальные карточки.

**Ключевая ценность:** Пользователь выбирает/создаёт задачи, выполняет их через "фокус-сессию" (таймер + фуллскрин), получает советы от AI, ведётся история выполнения и советов, можно выгрузить полный недельный отчёт в `.txt` + сделать бэкап/восстановление из файла.

---

## Прогрессивная модель лабораторных работ

Каждая лабораторная работа представляет собой **полное состояние проекта** на определённом этапе развития. Каждая следующая лаба включает в себя весь функционал предыдущей плюс новые возможности.

| Лаба | Тема | Что добавляется |
|------|------|-----------------|
| **Lab 1** | Пользовательский интерфейс (Activities) | 4 Activity, RecyclerView, базовая навигация |
| **Lab 2** | Lifecycle + передача данных | BaseActivity, lifecycle logging, Intent/Parcelable |
| **Lab 3** | Фрагменты и навигация | Single Activity, 4 Fragment, FragmentManager |
| **Lab 4** | Navigation Component + ViewBinding | NavController, Safe Args, DetailsFragment |
| **Lab 5** | Android Networking | Retrofit, AI API (glm-4.7-flash), обработка ошибок |
| **Lab 6** | Хранение данных + Focus Mode | DataStore, SharedPreferences, файловый I/O, полноэкранный таймер |
| **Lab 7** | Room + SSOT | База данных, Flow, Repository, холодный старт, пагинация |

---

## Сквозной функционал (финальное состояние Lab 7)

### Роли и сценарии

**Роль:** Один пользователь на устройстве (без реальной серверной авторизации; логика входа/регистрации учебная).

**User Flow (финальный):**

```
Onboard → SignIn → (SignUp при необходимости) → Home (список задач) →
Details (описание техники + таймер/Focus Mode) → (отметить выполнение) →
Settings (настройки, отчёт, бэкап)
```

### Основные сущности домена

**Task/Challenge (задача/привычка):**
- `id`, `title`, `techniqueName`, `description`
- `recommendedDurationMin`, `difficulty`, `category`
- `isCustom`, `createdAt`

**Completion (выполнение):**
- `id`, `taskId`, `dateTime`, `durationMin`
- `result` (успешно/прервано), `note`

**AiAdvice (совет/цитата):**
- `id`, `dateTime`, `text`
- `tags` (focus, procrastination), `mood`, `source` (= glm)

**User (учебная):**
- `name`, `email`, `password`
- Доп. поля (возраст/пол/обращение и т.п.)

---

## LAB 1 - "Пользовательский интерфейс" (Activities)

### Цель по методичке

Сделать приложение из **4 экранов**, каждый - отдельная **Activity**, с переходами "вперёд/назад".

### Экраны (обязательный минимум)

#### 1. OnboardActivity

**Требование:** Описание функционала + изображения/заголовки/подзаголовки.

**Содержание (2-3 карточки):**
- "Сила воли - тренируемый навык"
- "Планируй фокус-сессии"
- "Срывы - часть процесса"

**Кнопка:** "Начать" → SignInActivity

#### 2. SignInActivity

Ввод email/пароля + проверка (можно фиктивные данные или "любой непустой ввод").

**Валидация:**
- Email содержит `@`
- Пароль ≥ 4 символов (минимум)

**Кнопки:**
- "Войти" → HomeActivity
- "Регистрация" → SignUpActivity

#### 3. SignUpActivity

Ввод логина/имени, email, пароль + доп. поля (пол/возраст/обращение и т.д.) и расширенная проверка (формат/длина/символы).

**Опционально:** Добавить "уровень самодисциплины (1-5)"

#### 4. HomeActivity

Список элементов (RecyclerView), у каждого несколько уникальных полей, данные фиктивные.

**Содержание:** Список задач/челленджей:
- Title
- Technique (например: "Pomodoro", "2-minute rule")
- Duration
- Difficulty/Category

### Критерии приёмки Lab1

- [ ] 4 Activity, UI "живой", навигация работает (Intent)
- [ ] RecyclerView со списком задач на Home
- [ ] Валидации на SignIn/SignUp работают
- [ ] Стиль близок к Material Design 3 и адаптивен

---

## LAB 2 - "Lifecycle + передача данных между Activity"

### Цель по методичке

1. Логирование жизненного цикла в каждой Activity (желательно через наследование)
2. Переходы: Onboard → SignIn; SignIn → Home после проверки
3. Регистрация: SignIn → SignUp и возврат данных обратно через Intent
4. Показать **2 способа передачи данных**: String и объект User (Serializable/Parcelable)

### Реализация в теме WillPower

**BaseActivity:** Логирует onCreate/onStart/onResume/... с единым тегом (например `LifecycleTag`). Методичка прямо допускает наследование.

**Возврат из SignUp:**

*Вариант 1:* Вернуть `username` и `email` строками
*Вариант 2:* Вернуть `User` как Parcelable/Serializable

На SignIn после успешной регистрации отображать имя и email.

### Критерии приёмки Lab2

- [ ] В Logcat видно полный жизненный цикл для всех Activity
- [ ] Два способа передачи данных реализованы и демонстрируются

---

## LAB 3 - "Фрагменты и навигация между ними" (Single Activity)

### Цели по методичке

- Преобразовать 4 Activity в 4 Fragment
- Сделать одну MainActivity-хост
- Навигация через FragmentManager/FragmentTransaction + методы в MainActivity
- Передача данных Activity → Fragment

### Реализация в теме

**Fragment'ы:** `OnboardFragment`, `SignInFragment`, `SignUpFragment`, `HomeFragment`

**MainActivity:** Содержит `FragmentContainerView` (как требуется)

**Навигация:** `navigateToSignIn()`, `navigateToSignUp()`, `navigateToHome()` и т.д.

**Передача данных:**
- email/username через Bundle
- возврат "зарегистрированного User" через Fragment Result API (или интерфейс-коллбек)

### Критерии приёмки Lab3

- [ ] Одна Activity, остальное - фрагменты
- [ ] FragmentManager навигация и back stack работают
- [ ] Данные между экранами передаются уже "по-фрагментному"

---

## LAB 4 - "ViewBinding + Navigation Component" + DetailsFragment

### Цели по методичке

- Подключить Navigation Component, сделать navigation graph, перейти с FragmentManager на NavController
- Передача данных через Safe Args
- Включить ViewBinding и заменить findViewById на binding во всех фрагментах

### Новый экран: DetailsFragment

Открывается по клику на задачу из списка Home.

**Safe Args передаёт:** `taskId` (или весь Parcelable Task)

**Содержание DetailsFragment:**
- Заголовок задачи
- Описание техники
- Рекомендованная длительность
- Кнопки: "Старт Focus Mode", "Отметить выполнено"
- Таймер (обычный режим) + переход в Focus Mode (полноэкранный) - каркас

### Критерии приёмки Lab4

- [ ] Навигация полностью на Navigation Component
- [ ] Safe Args используется для передачи параметров
- [ ] ViewBinding подключён и применяется во всех фрагментах
- [ ] Из Home можно перейти в Details

---

## LAB 5 - "Android Networking" (AI-API)

### Цели по методичке

- Разрешение Internet в Manifest
- Выбрать HTTP-клиент (Retrofit или Ktor) + сериализация (kotlinx.serialization)
- Модели для JSON, репозиторий/DataSource, обработка ошибок
- Запрос при открытии Home и показ списка в RecyclerView

### Реализация: API open.bigmodel.cn

**Конфигурация:**
- `baseURL = https://open.bigmodel.cn/api/paas/v4`
- `model = glm-4.7-flash`

### Функционал в Lab5

**"AI совет дня" на Home:**
- При открытии Home: запрос → показываем блок "Совет дня"
- Кнопка "Обновить совет" (и/или swipe refresh)

### Обработка ошибок

- Нет интернета → показываем понятное сообщение (Snackbar/Toast) и не падаем
- Пустой/кривой ответ → fallback на локальную заглушку ("Сделай 2 минуты прямо сейчас…")

### Критерии приёмки Lab5

- [ ] Сеть подключена (permission + клиент + модели)
- [ ] Реальный запрос выполняется при открытии Home и влияет на UI
- [ ] Ошибки обработаны корректно (не крашится)

---

## LAB 6 - "Хранение данных в Android" (Settings + файлы + Focus Mode)

### Цели по методичке

- Разрешения на чтение/запись файлов в Manifest
- Создать SettingsFragment с полями/переключателями/кнопками
- Сохранение настроек: DataStore + SharedPreferences
- External Storage: `.txt` файл со списком объектов
- Бэкап: удаление файла + "незаметно" сохранить копию во внутреннем хранилище
- Отзывчивость интерфейса

### Настройки (минимум)

- **Notifications:** On/Off (DataStore)
- **Время Focus Mode:** 25/45/60 минут или кастом (DataStore)
- **Никнейм/Email:** (SharedPreferences)
- **Имя файла отчёта/бэкапа:** (SharedPreferences или DataStore)

### Focus Mode (обязателен)

Полноэкранный экран таймера (может быть отдельный `FocusModeFragment` или Activity).

**Функционал:**
- Полноэкранный режим
- Удержание экрана
- Скрытие system UI
- **Do Not Disturb** (если есть доступ/разрешение, иначе показать инструкцию)

Завершение сессии → записать выполнение (в Lab7 уйдёт в Room).

### Отчёт `.txt` (полный)

**Содержание:**
- Заголовок: диапазон дат недели
- Сводка: выполнено X/Y, streak, суммарное время фокуса
- Детализация по дням: задачи, длительности, статус
- Раздел "AI советы недели": список советов/цитат с датами

### Экспорт/импорт

- **Export:** Запись отчёта/бэкапа во внешнее хранилище (`/Documents` или `/Downloads`)
- **Delete:** Удаление внешнего файла с "незаметным" сохранением во внутреннее хранилище
- **Restore:** Вернуть внутреннюю копию обратно во внешнее хранилище

**UI в Settings показывает:**
- Существует ли внешний файл
- Его имя/путь/размер/дата
- Есть ли внутренняя копия (бэкап)
- Кнопки включаются/выключаются по состоянию

### Критерии приёмки Lab6

- [ ] DataStore + SharedPreferences реально используются и видны (после перезапуска настройки сохраняются)
- [ ] `.txt` создаётся во внешнем хранилище и отображается в Settings с метаданными
- [ ] Delete/Backup/Restore работает по сценарию методички
- [ ] UI отзывчивый, кнопки не "врут"

---

## LAB 7 - "Room + SSOT" (история выполнений и советов)

### Цели по методичке

- Хранить сетевые данные в Room: сущности + DAO
- Репозиторий/DataSource для CRUD
- "Холодный старт": если в БД есть данные - показываем из Room; если пусто - запрос к API
- "Обновить": повторный запрос к API и обновление БД
- "Загрузить ещё": получить список по другому номеру/параметру
- Reactive: наблюдаемый запрос в Room через Kotlin Flow

### Что храним в Room

1. **AiAdviceEntity** - ответы glm (совет/цитата)
2. **TaskEntity** - задачи (и предустановленные, и кастомные)
3. **CompletionEntity** - история выполнения (таймер/фокус-сессии)

### SSOT (Single Source of Truth)

- Home подписан на Flow из Room (список задач + блок "последний совет")
- Сеть (glm) обновляет Room, а UI автоматически отражает изменения через Flow

### Cold start / Refresh / Load more

**Cold start:**
- Если в таблице `AiAdvice` есть запись за сегодня → показываем
- Если нет → делаем запрос к glm и сохраняем

**Refresh:**
- Кнопка/SwipeRefresh: запрос нового совета → вставка в Room (или обновление "совета дня")

**Load more:**
- "Загрузить ещё советы" (например: запрашивать `N` советов по разным промптам/тегам: focus/procrastination/study)

### Критерии приёмки Lab7

- [ ] Room таблицы созданы, CRUD работает
- [ ] UI питается данными из Room через Flow, обновления реактивны
- [ ] Cold start/Refresh/Load more реализованы

---

## План работ по этапам

### Этап 1 (Lab1)
- UI макеты 4 Activity
- RecyclerView задач на Home
- Навигация Intent

### Этап 2 (Lab2)
- BaseActivity + lifecycle logging
- Возврат из SignUp в SignIn: String + User Parcelable

### Этап 3 (Lab3)
- Перевести в Single Activity + 4 фрагмента
- Навигация FragmentManager

### Этап 4 (Lab4)
- Navigation graph + Safe Args + ViewBinding
- Добавить DetailsFragment и переход из Home

### Этап 5 (Lab5)
- Internet permission
- Retrofit/Ktor + модели + репозиторий + обработка ошибок
- Запрос совета при открытии Home

### Этап 6 (Lab6)
- SettingsFragment + DataStore/SharedPrefs
- Focus Mode (fullscreen таймер)
- Экспорт отчёта `.txt` во внешнее хранилище
- Backup/Delete/Restore по методичке

### Этап 7 (Lab7)
- Room + Flow + Repository + SSOT
- Хранение советов и выполнений
- Cold start / refresh / load more
- Отчёт/бэкап теперь формируется из Room-данных

---

## Что сдаём на каждую лабу

Для каждой лабы:

- Рабочий Android-проект
- Код соответствует требованиям лабы
- Демонстрация в эмуляторе/на устройстве:
  - **Lab2:** Показать лог жизненного цикла
  - **Lab5:** Показать успешный сетевой запрос и обработку ошибки (например, выключить интернет)
  - **Lab6:** Показать создание `.txt`, удаление (с внутренним бэкапом) и восстановление
  - **Lab7:** Показать cold start (сначала пусто → запрос), затем повторный запуск (берёт из Room)

---

## Важные "не забыть" моменты (частые ошибки на защите)

- **Lab4:** Safe Args реально должны использоваться, а не "просто Bundle"
- **Lab5:** Обязательно обработка ошибок (нет сети/пустой ответ), иначе валят
- **Lab6:** Показать не только запись файла, но и **инфо о файле** + **удаление → скрытый бэкап → восстановление**
- **Lab7:** UI должен жить от Room (Flow), а сеть - обновлять БД (SSOT)
